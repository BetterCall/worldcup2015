var worldcupApp=angular.module("worldcup2015",[]).factory("_",function(){return window._}).factory("moment",function(){return window.moment});worldcupApp.config(["$interpolateProvider",function(e){e.startSymbol("[["),e.endSymbol("]]")}]),worldcupApp.controller("ScheduleCtrl",["$scope","MatchesSvc","_","$log","moment",function(e,t,n,a,c){"use strict";e.timeFlag=!1,e.toggleTimeFlag=function(){e.timeFlag=!e.timeFlag},e.teamsInPool=function(t){for(var a,c=[],s=0;a=e.teams[s];s++)a.pool===t&&c.push(a);var o=n(c).chain().sortBy("nrr").sortBy("pts").reverse().value();return o},t.getAllMatches().success(function(n){t.setMatches(n.matches),e.teams=n.teams,e.poolATeams=e.teamsInPool("A"),e.poolBTeams=e.teamsInPool("B"),e.dates=t.getAllMatchDates(),e.venues=t.getAllVenues(),e.showTodaysMatches=function(){var t=new Date,n=t.getDate(),a=t.getMonth()+1,c=t.getFullYear();10>n&&(n="0"+n),10>a&&(a="0"+a),t=c+"-"+a+"-"+n,e.onDateSelect(t),s()},e.showTodaysMatches()}),e.month=function(e){return"2"===e.substr(6,1)?"Feb":"Mar"},e.dateOfMonth=function(e){return e.substr(8,2)},e.getTime=function(t){return e.timeFlag?e.month(t.match_date).toUpperCase()+" "+e.dateOfMonth(t.match_date).toUpperCase()+" "+t.start_time.toUpperCase():c(t.match_datetime).format("MMM DD hh:mm A").toUpperCase()},e.selectedMatches={},e.onDateSelect=function(n,a){a=a||!1,!e.staySelected&&a&&(e.staySelected=!0),e.deselectAll(),e.selectedMatches=t.getMatchesForDate(n),o(),r()};var s=function(){e.dates=n.map(e.dates,function(t){return n.each(e.selectedMatches,function(e){e.match_date===t.date&&(t.selected=!0)}),t})},o=function(){e.teams=n.map(e.teams,function(t){return n.each(e.selectedMatches,function(e){(e.team_one_long===t.name||e.team_two_long===t.name)&&(t.selected=!0)}),t})},r=function(){e.venues=n.map(e.venues,function(t){return n.each(e.selectedMatches,function(e){e.city===t.city&&(t.selected=!0)}),t})};e.onTeamSelect=function(n,a){a=a||!1,!e.staySelected&&a&&(e.staySelected=!0),e.deselectAll(),e.selectedMatches=t.getMatchesForTeam(n),s(),r()},e.onVenueSelect=function(n,a){a=a||!1,!e.staySelected&&a&&(e.staySelected=!0),e.deselectAll(),e.selectedMatches=t.getMatchesForVenue(n),s(),o()},e.deselectAll=function(){e.staySelected||(e.selectedMatches={});for(var t,n=0;t=e.dates[n];n++)t.selected=!1;for(var a,n=0;a=e.teams[n];n++)a.selected=!1;for(var c,n=0;c=e.venues[n];n++)c.selected=!1}}]),angular.module("worldcup2015").service("MatchesSvc",["_","moment","$http",function(e,t,n){this.matches=null,this.setMatches=function(e){this.matches=e},this.getAllMatches=function(){var e={itinora:(new Date).getTime()},t={params:e};return n.get("/static/data/matches.json",t)},this.getAllVenues=function(){return e.unique(e.map(this.matches,function(e){return{city:e.city,stadium:e.stadium,selected:!1}}),!1,function(e){return e.city})},this.getAllMatchDates=function(){return e.unique(e.sortBy(e.map(this.matches,function(e){return{date:e.match_date,selected:!1,pool:e.pool}}),"date"),!1,function(e){return e.date})},this.getMatchesForDate=function(t){return e.where(this.matches,{match_date:t})},this.getMatchesForTeam=function(t){return e.filter(this.matches,function(e){return e.team_one_long===t.name||e.team_two_long===t.name})},this.getMatchesForVenue=function(t){return e.where(this.matches,{city:t.city})}}]);